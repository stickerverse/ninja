!function(){"use strict";function t(t){switch(typeof t){case"string":{const e=t.trim();if(function(t){return Boolean(t.match(/^(?:[1-9][0-9]*)*[0-9]$/))}(e)){const t=Number(e);return Number.isSafeInteger(t)?t:0}if(function(t){return Boolean(t.match(/^(?:[1-9][0-9]*)*[0-9]\.[0-9]+$/))}(e)){const t=Number(e);return t<=Number.MAX_VALUE?t:0}return 0}case"number":{if(Number.isInteger(t))return Number.isSafeInteger(t)&&t>0?t:0;const e=Number.parseFloat(String(t));return Number.isFinite(e)?e:0}case"bigint":{const e=Number(t);return Number.isSafeInteger(e)&&e>0?e:0}default:return 0}}function e(t){try{return new URL(../../terms-and-conditions/index.html).href}catch(t){return""}}function n(t,e){e="object"==typeof e?e:{};var n=(e=Object.keys(e).sort((function(t,e){return t-e})))[0],i=e[e.length-1];if(t<n)return n;if(t>i)return i;for(let n=e.length-1;n>=0;n--)if(t>=e[n])return e[n]}function i(t){const e=parseFloat(t?.value||0);return e!=e?0:e}function r(t,e,n){return t=parseFloat(t),e=parseFloat(e),n=parseFloat(n),t<e||t>n?`must be a number between ${e} and ${n}. A value of ${t} was provided.`:""}class o{#t=0;#e;#n;#i;constructor(t){const{count:e,limit:n}=t;this.#t=e,this.#i=n;const{countEl:i,el:r}=this.#r();this.#e=i,this.#n=r}get count(){return this.#t}get el(){return this.#n}get limit(){return this.#i}withCount(t){return this.#t=t,this.#e.textContent=String(t),this}#r(){const t="snoof-customer-note-constraints",e=document.createElement("span");e.classList.add(`${t}-count`),e.textContent=String(this.#t);const n=document.createElement("span");n.classList.add(`${t}-limit`),n.textContent=String(this.#i);const i=document.createElement("div");return i.classList.add(`${t}`),i.append(e,"../../index.html",n),{countEl:e,el:i,limitEl:n}}}function a(t){if(Intl.Segmenter){const e=new Intl.Segmenter("en",{granularity:"grapheme"}).segment(t);return Array.from(e).length}return[...t].length}function s(t,e){if(Intl.Segmenter){const n=new Intl.Segmenter("en",{granularity:"grapheme"}).segment(t);return Array.from(n).slice(0,e).map((t=>t.segment)).join("")}return[...t].slice(e).join("")}const l=document.querySelector(".snoof-custom-product-form"),u=l.querySelector("#SnDialog"),h=l.querySelector('button[name="add-to-cart"]'),m=new class{#o=0;#a=0;#s=0;#l=0;#u=0;constructor(t){t="object"==typeof t?t:{},"number"==typeof t?.maxArea&&t.maxArea>0&&(this.#o=t.maxArea),"number"==typeof t?.maxHeight&&t.maxHeight>0&&(this.#a=t.maxHeight),"number"==typeof t?.maxWidth&&t.maxWidth>0&&(this.#s=t.maxWidth),"number"==typeof t?.minHeight&&t.minHeight>0&&(this.#l=t.minHeight),"number"==typeof t?.minWidth&&t.minWidth>0&&(this.#u=t.minWidth)}bindArea(e){let n,i;return e>this.#o?(n=this.#o,i=`Area must be less than or equal to ${this.#o} square inches.`):(n=e,i=""),n=t(n),{value:n,message:i}}bindHeight(e){let n,i;return e<this.#l?(n=this.#l,i=`Height must be greater than or equal to ${this.#l}.`):e>this.#a?(n=this.#a,i=`Height must be less than or equal to ${this.#a}.`):(n=e,i=""),n=t(n),{value:n,message:i}}bindWidth(e){let n,i;return e<this.#u?(n=this.#u,i=`Width must be greater than or equal to ${this.#u}.`):e>this.#s?(n=this.#s,i=`Width must be less than or equal to ${this.#s}.`):(n=e,i=""),n=t(n),{value:n,message:i}}validateArea(t){const{message:e}=this.bindArea(t);return e}validateHeight(t){const{message:e}=this.bindHeight(t);return e}validateWidth(t){const{message:e}=this.bindWidth(t);return e}}(window?.snoofMatrixConfig||{}),g=new class{#n;constructor(t){if("function"!=typeof t?.querySelector)throw new Error("Parameter one `el` must be an HTML element.");this.#n=t}message(t){return t="string"==typeof t?t.trim():"",this.#n.textContent=t,this}hide(){return this.#n.classList.add("VisuallyHidden"),this}show(){return this.#n.classList.remove("VisuallyHidden"),this}moveAfter(t){return"function"==typeof t.append&&t.after(this.#n),this}}(u),d=new class{#h;#m;#g;#d;#c;#p;#f;#y;constructor(t,n){if("function"!=typeof t?.querySelector)throw new Error("Parameter one `form` must be an HTML element.");this.#m=new Map(Object.entries({container:t.querySelector("#SnprControlUpload"),extensionInput:t.querySelector('input[type="hidden"][name="SnControlUploadExtension"]'),fileInput:t.querySelector('input[type="file"][data-snoof-upload-input]'),filenameInput:t.querySelector('input[type="hidden"][name="SnControlUploadFilename"]'),form:t,largeInput:t.querySelector('input[type="hidden"][name="SnControlUploadLarge"]'),preview:t.querySelector(".snoof-upload-preview"),removeButton:t.querySelector(".snoof-upload-remove-file"),smallInput:t.querySelector('input[type="hidden"][name="SnControlUploadSmall"]')}));const i=function(t){t=t||{};const n=Object.create(null);return n.dialogs=function(t){const e=new Map;for(const n in t){if("string"!=typeof n)continue;const i="string"==typeof t[n]?t[n].trim():"";""!==i&&e.set(n,i)}return e}(t.dialogs),n.tokenDelete="string"==typeof t.tokenDelete?t.tokenDelete.trim():"",n.tokenUpload="string"==typeof t.tokenUpload?t.tokenUpload.trim():"",n.uploadMax=Number.isInteger(t.uploadMax)?t.uploadMax:0,n.urlAjax=e(t.urlAjax),n.urlTemp=e(t.urlTemp),n.supportedFileTypes=function(t){const e=Object.create(null);for(const n in t){if("string"!=typeof n)continue;const i=Array.isArray(t[n])?t[n]:[];for(let t=0;t<i.length;t++){const r="string"==typeof i[t]?i[t].trim():"";""!==r&&(void 0===e[n]&&(e[n]=[]),e[n].push(r))}}return e}(t.supportedFileTypes),n}(n);if(""===i.urlAjax)throw new Error("config.urlAjax must be a valid URL.");if(""===i.urlTemp)throw new Error("config.urlTemp must be a valid URL.");this.#p=i.uploadMax,this.#h=i.dialogs,this.#g=i.supportedFileTypes,this.#d=i.tokenDelete,this.#c=i.tokenUpload,this.#f=i.urlAjax,this.#y=i.urlTemp,function(t){if("function"!=typeof t.get("extensionInput")?.querySelector)throw new Error('Form must contain a hidden input named "SnControlUploadExtension".');if("function"!=typeof t.get("fileInput")?.querySelector)throw new Error('Form must contain a file input with a "data-snoof-upload-input" attribute.');if("function"!=typeof t.get("filenameInput")?.querySelector)throw new Error('Form must contain a hidden input named "SnControlUploadFilename".');if("function"!=typeof t.get("smallInput")?.querySelector)throw new Error('Form must contain a hidden input named "SnControlUploadSmall".');if("function"!=typeof t.get("largeInput")?.querySelector)throw new Error('Form must contain a hidden input named "SnControlUploadSmall".');if("function"!=typeof t.get("preview")?.querySelector)throw new Error('Form must contain an element with a class of "snoof-upload-preview".');if("function"!=typeof t.get("removeButton")?.querySelector)throw new Error('Form must contain an element with a class of ".snoof-upload-remove-file".')}(this.#m)}async handleFileUpload(t){const e=this.validateStagedFile();if(""!==e)return void t.message(e).moveAfter(this.getEl("fileInput")).show();this.getEl("preview").classList.add("Loading"),t.message(this.getDialog("fileUploadProcessingStepOne")).moveAfter(this.getEl("fileInput"));const n=new FormData(this.getEl("form"));n.append("action","SnUploadArtwork"),n.append("nonce",this.getToken("upload"));const i=await fetch(this.getUrl("fetch"),{method:"POST",body:n});if(200!==i.status){const e=await i.json(),n="string"==typeof e?.dialog?e?.dialog:"fileUploadErrorDefault",r=this.getDialog(n);return void t.message(r).moveAfter(this.getEl("removeButton")).show()}const r=function(t){t="object"==typeof t?t:{};return{dialog:"string"==typeof t?.dialog?t.dialog.trim():"",extension:"string"==typeof t?.extension?t.extension.trim():"",filename:"string"==typeof t?.filename?t.filename.trim():"",large:"string"==typeof t?.large?t.large.trim():"",name:"string"==typeof t?.name?t.name.trim():""}}(await i.json()),o=this.validateFileUploadData(r);if(""!==o)return void t.message(o).show().moveAfter(this.getEl("fileInput"));this.getEl("largeInput").setAttribute("value",r.large),this.getEl("extensionInput").setAttribute("value",r.extension),this.getEl("filenameInput").setAttribute("value",r.filename),this.getEl("container").classList.add("SnUploadSuccess","hasUploadedFile"),t.message(this.getDialog("fileUploadProcessingStepTwo")).moveAfter(this.getEl("removeButton")).show();var a=new FormData;a.append("action","SnCreateThumbnail"),a.append("nonce",this.getToken("upload")),a.append("filename",r.large);const s=await fetch(this.getUrl("fetch"),{method:"POST",body:a}),l=function(t){t="object"==typeof t?t:{};return{dialog:"string"==typeof t?.dialog?t.dialog.trim():"",filename:"string"==typeof t?.filename?t.filename.trim():""}}(await s.json()),u=document.createElement("img");if(200===s.status){const e=this.getDialog("createThumbSuccess");t.message(e).moveAfter(this.getEl("removeButton")).show();const n=l.filename;u.setAttribute("src",this.getUrl("temp")+n),this.getEl("smallInput").setAttribute("value",n)}else{const e=this.getDialog("fileUploadErrorDefault");t.message(e).moveAfter(this.getEl("removeButton")).show(),u.setAttribute("src",this.getUrl("temp")+"default.png")}this.getEl("preview").textContent="",this.getEl("preview").append(u),this.getEl("preview").classList.remove("VisuallyHidden"),this.getEl("preview").classList.remove("Loading")}async handleDeleteLastUpload(){let t=new FormData;t.append("action","SnDeleteArtwork"),t.append("nonce",this.getToken("delete")),t.append("small",this.getEl("smallInput").getAttribute("value")),t.append("large",this.getEl("largeInput").getAttribute("value")),(""!==t.small||""!==t.large)&&(this.getEl("preview").textContent="",200===(await fetch(this.getUrl("fetch"),{method:"POST",body:t})).status&&(this.getEl("preview").textContent="",this.getEl("fileInput").setAttribute("value",""),this.getEl("smallInput").setAttribute("value",""),this.getEl("largeInput").setAttribute("value",""),this.getEl("extensionInput").setAttribute("value",""),this.getEl("filenameInput").setAttribute("value",""))),this.getEl("container").classList.remove("SnUploadSuccess","hasUploadedFile")}hasStagedFile(){return this.getEl("fileInput")?.files?.length>0}hasStickyFile(){return""!==this.getEl("largeInput").getAttribute("value")&&""!==this.getEl("smallInput").getAttribute("value")&&""!==this.getEl("extensionInput").getAttribute("value")&&""!==this.getEl("filenameInput").getAttribute("value")}getDialog(t){return this.#h.has(t)?this.#h.get(t):"Sorry, an unexpected error happend."}getEl(t){if(this.#m.has(t))return this.#m.get(t);throw new Error('Unrecognized element "'+t+'".')}getStagedFileData(){if(this.getEl("fileInput")?.files?.length>0){const t=this.getEl("fileInput")?.files[0];return{name:"string"==typeof t?.name?t.name:"",size:"number"==typeof t?.size?t.size:0,type:"string"==typeof t?.type?t.type:""}}return{name:"",size:0,type:""}}getToken(t){return"delete"===t?this.#d:"upload"===t?this.#c:""}getUrl(t){if("temp"===t)return this.#y;if("fetch"===t)return this.#f;throw new Error('Unrecognized url type "'+t+'".')}validate(){return this.hasStagedFile()||this.hasStickyFile()?"":"Please upload a file."}validateStagedFile(){var t,e,n=this.getStagedFileData();return n.size>=this.#p?this.getDialog("tooLarge"):void 0===(e=this.#g)[n.type]?this.getDialog("invalidType"):(t=function(t){if("string"==typeof t){const e=t.split(".");return e[e.length-1].toLowerCase()}return""}(n.name),e[n.type].indexOf(t)<0?this.getDialog("fileUploadInvalidExtension")+" === "+t:"")}validateFileUploadData(t){return(t="object"==typeof t?t:{}).hasOwnProperty("extension")&&t.hasOwnProperty("filename")&&t.hasOwnProperty("large")&&t.hasOwnProperty("name")?"string"==typeof t?.dialog&&""!==t.dialog.trim()?t.dialog.trim():"string"!=typeof t?.extension||""===t.extension.trim()?this.getDialog("fileUploadInvalidExtension"):"string"!=typeof t?.filename||""===t.filename.trim()?this.getDialog("fileUploadInvalidHash"):"string"!=typeof t?.large||""===t.large.trim()?this.getDialog("fileUploadFile"):"string"!=typeof t?.name||""===t.name.trim()?this.getDialog("fileUploadFilename"):"":this.getDialog("fileUploadMissingData")}}(l,window?.snoofUploadConfig),c=new class{#v;#m;#E;#a;#w;#s;#l;#b;#u;#S;constructor(t,e,n){if("function"!=typeof t?.querySelector)throw new Error("Parameter one `form` must be an HTML element.");this.#v=n,this.#m=new Map(Object.entries({width:t.querySelector("#SnControlWidth"),height:t.querySelector("#SnControlHeight"),quantity:t.querySelector("#SnQuantity"),presetSizes:t.querySelectorAll("#SnControlPresetSize button"),amount:t.querySelector(".snoof-price-value"),submit:t.querySelector('button[name="add-to-cart"]')})),this.#E=e.matrix,this.#a=e.maxWidth,this.#w=e.maxQty,this.#s=e.maxWidth,this.#l=e.minHeight,this.#b=e.minQty,this.#u=e.minWidth,this.#S=e.multiplier}addDimensionListeners(t){const e=this;return this.getEl("width").addEventListener("change",(n=>((t,n)=>{const i=t?.target;if(!t)return;const{value:r}=e.#v.bindWidth(i?.value);i.value=r,e.trimDecimal(i),e.handlePriceChange(),n.message("").hide()})(n,t))),this.getEl("height").addEventListener("change",(n=>((t,n)=>{const i=t?.target;if(!t)return;const{value:r}=e.#v.bindHeight(i?.value);i.value=r,e.trimDecimal(i),e.handlePriceChange(),n.message("").hide()})(n,t))),e}addPresetSizeListeners(){const t=t=>{const e=t?.target,n=e?.dataset?.width,i=e?.dataset?.height;this.getEl("width").value=n,this.getEl("width").dispatchEvent(new Event("change")),this.getEl("height").value=i,this.getEl("height").dispatchEvent(new Event("change"))};return this.getEl("presetSizes").forEach((e=>{e.addEventListener("click",(e=>t(e)))})),this}addQuantityListeners(t){const e=t=>{this.handlePriceChange(),t.message("").hide()};return this.getEl("quantity").addEventListener("input",(()=>{e(t)})),this.getEl("quantity").addEventListener("change",(()=>{e(t)})),this}trimDecimal(t){const e="string"==typeof t?.value||"number"==typeof t?.value?String(t.value):"",n=e.split(".");(n.length>1?n[n.length-1].length:0)>3&&(t.value=parseFloat(e).toFixed(3))}getEl(t){if(this.#m.has(t))return this.#m.get(t);throw new Error('Unrecognized element "'+t+'".')}getPrice(t,e,n,i){var r=this.getPricePerUnit(t,e,n,i);return(r=parseFloat(r))*n}getPricePerUnit(t,e,i,r){var o,a,s="";return o=n((t=parseFloat(t))*(e=parseFloat(e)),this.#E),s=function(t){return t=""===(t=(t=String(t).trim()).length>0&&"$"===t.split("")[0]?t.substr(1):t)?0:parseFloat(t)}(s=(i=n(i,a=o&&this.#E.hasOwnProperty(o)&&"object"==typeof this.#E[o]?this.#E[o]:{}))&&"object"==typeof a&&a.hasOwnProperty(i)&&"string"==typeof a[i]?a[i]:""),r>0?s+=s*(r/100):r<0&&(s-=s*(Math.abs(r)/100)),s}validate(){const t=r(this.getEl("width").value,this.#u,this.#s);if(t)return`Value for width ${t}`;const e=r(this.getEl("height").value,this.#l,this.#a);if(e)return`Value for height ${e}`;const n=r(this.getEl("quantity").value,this.#b,this.#w);return n?`Value for quantity ${n}`:""}handlePriceChange(){const t=i(this.getEl("width")),e=i(this.getEl("height")),n=i(this.getEl("quantity")),r=this.getPrice(t,e,n,this.#S);""===r?(this.getEl("amount").textContent="$-.--",this.getEl("submit").classList.add("disabled")):(this.getEl("amount").textContent=function(t){return"$"+(t=(t=parseFloat(t)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"))}(r),this.getEl("submit").classList.remove("disabled"))}}(l,window?.snoofMatrixConfig,m);c.addDimensionListeners(g).addPresetSizeListeners().addQuantityListeners(g),d.getEl("removeButton").addEventListener("click",(function(t){t.preventDefault(),d.handleDeleteLastUpload(),g.message("").hide()})),d.getEl("fileInput").addEventListener("click",(function(){g.message("").hide(),d.handleDeleteLastUpload()})),d.getEl("fileInput").addEventListener("change",(function(){d.handleFileUpload(g)})),h.addEventListener("click",(function(t){const e=c.validate();e&&(t.preventDefault(),g.show().message("Error: "+e).moveAfter(h));const n=d.validate();n&&(t.preventDefault(),g.show().message("Error: "+n).moveAfter(h))})),document.addEventListener("DOMContentLoaded",(function(){!function(){console.log("initCustomerNote()");const{limit:t,selector:e}={limit:450,selector:".snoof-customer-note"};if("string"!=typeof e)return void console.warn("CustomerNote: Selector must be a string");const n=document.querySelectorAll(e);if(n.length<1)console.warn(`CustomerNote: No elements found for selector: ${e}`);else for(const e of n){const n=".snoof-customer-note-value",i=e.querySelector(n);if(!i)return;let r=a(i.value);const l=new o({count:r,limit:t});e.append(l.el),i.addEventListener("input",(function(){if(r=a(i.value),r>t){const e=s(i.value,t);i.value=e,r=a(i.value)}l.withCount(r)}))}}()}))}();